---
interface TabItem {
  id: string | number;
  name: string;
  isActive?: boolean;
}

interface Props {
  tabItems: TabItem[];
  containerId?: string;
}

const { tabItems, containerId = "tabs-container" } = Astro.props;

const activeTabId =
  tabItems.find((item) => item.isActive)?.id?.toString() ?? tabItems[0]?.id?.toString();
---

<div class="tabs-wrapper flex w-full flex-col gap-6 md:items-center md:gap-7 lg:gap-9">
  <!-- Tabs Buttons -->
  <div class="scrollbar-hide w-full overflow-x-auto whitespace-nowrap">
    <div id={containerId} class="flex items-center gap-3.5 md:justify-center md:gap-5 lg:gap-6">
      {
        tabItems.map((tabItem) => {
          const isActive = tabItem.id.toString() === activeTabId;

          return (
            <button
              data-tab-id={tabItem.id}
              class={`border-n-950 bg-n-100 hover:border-n-100 cursor-pointer rounded-4xl border px-4 py-2.5 transition-colors ${
                isActive ? "text-n-100 bg-n-950" : "text-n-950"
              }`}
            >
              <p class="leading-light text-sm font-normal tracking-normal md:text-lg lg:text-xl">
                {tabItem.name}
              </p>
            </button>
          );
        })
      }
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content-wrapper w-full">
    <slot />
  </div>
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const wrappers = document.querySelectorAll(".tabs-wrapper");

    wrappers.forEach((wrapper) => {
      const container = wrapper.querySelector("div[id]");
      const panelList = wrapper.querySelectorAll("[data-tab-content-id]");

      if (!container) return;

      const initialActive = container
        .querySelector("[data-tab-id].bg-n-950")
        ?.getAttribute("data-tab-id");

      // INIT â€” show selected tab only
      panelList.forEach((panel) => {
        panel.classList.toggle(
          "hidden",
          panel.getAttribute("data-tab-content-id") !== initialActive,
        );
      });

      // EVENT: Handle tab switching
      container.addEventListener("click", (event) => {
        const btn = event.target.closest("button");
        if (!btn || !container.contains(btn)) return;

        const id = btn.getAttribute("data-tab-id");

        // Update button styles
        container.querySelectorAll("button").forEach((b) => {
          const bId = b.getAttribute("data-tab-id");
          b.classList.toggle("bg-n-950", bId === id);
          b.classList.toggle("text-n-100", bId === id);
          b.classList.toggle("text-n-950", bId !== id);
        });

        // Update content panels
        panelList.forEach((panel) => {
          const panelId = panel.getAttribute("data-tab-content-id");
          panel.classList.toggle("hidden", panelId !== id);
        });
      });
    });
  });
</script>
