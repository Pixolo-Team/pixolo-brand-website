---
// COMPONENTS //
import { Icon } from "astro-icon/components";

// OTHERS //
import BrandLogo from "./BrandLogo.astro";
import RoundedButton from "./RoundedButton.astro";

interface Props {
  menuItems: { name: string; url: string }[];
}

const { menuItems = [] } = Astro.props;
const currentPath = Astro.url.pathname;
---

<div
  id="mobile-menu"
  class="fixed inset-0 z-50 hidden bg-n-50 opacity-0 transition-opacity duration-300 ease-in-out lg:hidden"
  aria-hidden="true"
>
  <div class="container mx-auto flex flex-col justify-between py-5 px-6 h-full">
    <!-- Logo + Close Button -->
    <div class="flex justify-between items-center">
      <BrandLogo width={140} />

      <button
        id="mobile-menu-close"
        class="flex justify-center items-center size-14 bg-n-100 rounded-full"
        aria-label="Close mobile menu"
        type="button"
      >
        <Icon name="close" />
      </button>
    </div>

    <!-- Menu Items -->
    <div class="flex flex-col flex-1 gap-6 leading-tight pt-28">
      {
        menuItems.map((item) => {
          const isActive = currentPath === item.url;
          return (
            <a
              href={item.url}
              class={`font-normal text-4xl transition-colors leading-tight ${
                isActive ? "text-n-950" : "text-n-500"
              }`}
            >
              {item.name}
            </a>
          );
        })
      }
    </div>

    <!-- Bottom Buttons -->
    <div class="justify-center flex flex-row gap-2.5">
      <RoundedButton buttonText="Call" />
      <RoundedButton buttonText="Whatsapp" />
    </div>
  </div>
</div>

<script>
  const openBtn = document.getElementById("open-mobile-menu-button");
  const closeBtn = document.getElementById("mobile-menu-close");
  const menu = document.getElementById("mobile-menu");

  const OPEN_CLOSE_MS = 300; // matches transition duration

  /** OPEN MOBILE MENU */
  const openMobileMenu = () => {
    if (!menu) return;

    menu.classList.remove("hidden");
    requestAnimationFrame(() => {
      menu.classList.remove("opacity-0");
      menu.classList.add("opacity-100");
    });

    menu.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  };

  /** CLOSE MOBILE MENU */
  const closeMobileMenu = () => {
    if (!menu) return;

    menu.classList.remove("opacity-100");
    menu.classList.add("opacity-0");

    setTimeout(() => {
      menu.classList.add("hidden");
      menu.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }, OPEN_CLOSE_MS);
  };

  openBtn?.addEventListener("click", openMobileMenu);
  closeBtn?.addEventListener("click", closeMobileMenu);

  // Close on clicking menu links
  menu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", closeMobileMenu);
  });
</script>
