---
// COMPONENTS //
import { Icon } from "astro-icon/components";

// OTHERS //
import BrandLogo from "./BrandLogo.astro";
import RoundedButton from "./RoundedButton.astro";

// Define props
interface Props {
  menuItems: { name: string; url: string }[];
}

const { menuItems = [] } = Astro.props;
const currentPath = Astro.url.pathname;
---

<div
  id="mobile-menu"
  class="bg-n-50 fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300 ease-in-out lg:hidden"
  aria-hidden="true"
>
  <div class="container mx-auto flex h-full flex-col justify-between px-6 py-5">
    <!-- Logo + Close Button -->
    <div class="flex items-center justify-between">
      <BrandLogo width={140} />

      <button
        id="mobile-menu-close"
        class="bg-n-100 flex size-14 items-center justify-center rounded-full"
        aria-label="Close mobile menu"
        type="button"
      >
        <Icon name="close" />
      </button>
    </div>

    <!-- Menu Items -->
    <div class="flex flex-1 flex-col gap-6 pt-28 leading-tight z-10">
      {
        menuItems.map((item) => {
          const isActive = currentPath === item.url;
          return (
            <a
              href={item.url}
              class={`nav-link hidden-pos text-4xl leading-tight font-normal transition-colors ${
                isActive ? "text-n-950" : "text-n-500"
              }`}
            >
              {item.name}
            </a>
          );
        })
      }
    </div>

    <!-- Bottom Buttons -->
    <div class="flex flex-row justify-center gap-2.5">
      <RoundedButton buttonText="Call" />
      <RoundedButton buttonText="Whatsapp" />
    </div>
  </div>

  <!-- Floating Pixolo logo icon -->
  <Icon
    name={"pixolo-icon"}
    class="right-20px absolute top-28 -right-30 size-48 -rotate-30"
  />

  <!-- Circle at back of the links -->
  <div
    class="absolute size-[500px] rounded-full bg-n-500 left-[-75%] opacity-5 top-[10%]"
  >
  </div>
</div>
<style>
  .nav-link.hidden-pos {
    opacity: 0;
    transform: translateX(-20px);
  }

  /* Open animation */
  @keyframes nav-link-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .nav-link.start {
    animation: nav-link-in 0.3s ease forwards;
  }

  /* Close animation */
  @keyframes nav-link-out {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(-20px);
    }
  }

  .nav-link.reverse {
    animation: nav-link-out 0.3s ease forwards;
  }
</style>

<script>
  const openBtn = document.getElementById("open-mobile-menu-button");
  const closeBtn = document.getElementById("mobile-menu-close");
  const menu = document.getElementById("mobile-menu");

  /** OPEN MOBILE MENU */
  const openMobileMenu = () => {
    if (!menu) return;

    const links = menu.querySelectorAll("a.nav-link");

    // Restart animation properly
    links.forEach((link, index) => {
      link.classList.add("opacity-0");
      link.classList.remove("reverse");
      link.classList.remove("hidden-pos");
      link.classList.add("start");
      link.style.animationDelay = `${index * 0.1}s`;
    });

    menu.classList.remove("hidden");
    requestAnimationFrame(() => {
      menu.classList.remove("opacity-0");
      menu.classList.add("opacity-100");
    });

    menu.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  };

  /** CLOSE MOBILE MENU */
  const closeMobileMenu = () => {
    if (!menu) return;

    const links = menu.querySelectorAll("a.nav-link");

    links.forEach((link, index) => {
      link.classList.remove("opacity-0");
      link.classList.remove("start");
      link.classList.add("reverse");
      link.style.animationDelay = `${(links.length - 1 - index) * 0.1}s`;
    });

    // Time for for the animation to get over
    const lastDelay = (links.length - 1) * 100; // in ms
    const totalTime = lastDelay + 300;

    setTimeout(() => {
      menu.classList.add("hidden");
      menu.setAttribute("aria-hidden", "true");

      // Reset reverse class
      links.forEach((link) => link.classList.remove("reverse"));

      document.body.style.overflow = "";
    }, totalTime);
  };

  openBtn?.addEventListener("click", openMobileMenu);
  closeBtn?.addEventListener("click", closeMobileMenu);

  // Close on clicking menu links
  menu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", closeMobileMenu);
  });
</script>
