---
// COMPONENTS //
import { Icon } from "astro-icon/components";

// OTHERS //
import BrandLogo from "./BrandLogo.astro";
import RoundedButton from "./RoundedButton.astro";

// Define props
interface Props {
  menuItems: { name: string; url: string }[];
}

const { menuItems = [] } = Astro.props;
const currentPath = Astro.url.pathname;
---

<div
  id="mobile-menu"
  class="bg-n-50 fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300 ease-in-out lg:hidden"
  aria-hidden="true"
>
  <div class="container mx-auto flex h-full flex-col justify-between px-6 py-5">
    <!-- Logo + Close Button -->
    <div class="flex items-center justify-between">
      <BrandLogo width={140} />

      <button
        id="mobile-menu-close"
        class="bg-n-100 flex size-14 items-center justify-center rounded-full"
        aria-label="Close mobile menu"
        type="button"
      >
        <Icon name="close" />
      </button>
    </div>

    <!-- Menu Items -->
    <div class="flex flex-1 flex-col gap-6 pt-28 leading-tight">
      {
        menuItems.map((item) => {
          const isActive = currentPath === item.url;
          return (
            <a
              href={item.url}
              class={`text-4xl leading-tight font-normal transition-colors ${
                isActive ? "text-n-950" : "text-n-500"
              }`}
            >
              {item.name}
            </a>
          );
        })
      }
    </div>

    <!-- Bottom Buttons -->
    <div class="flex flex-row justify-center gap-2.5">
      <RoundedButton buttonText="Call" />
      <RoundedButton buttonText="Whatsapp" />
    </div>
  </div>
</div>

<script>
  const openBtn = document.getElementById("open-mobile-menu-button");
  const closeBtn = document.getElementById("mobile-menu-close");
  const menu = document.getElementById("mobile-menu");

  const OPEN_CLOSE_MS = 300; // matches transition duration

  /** OPEN MOBILE MENU */
  const openMobileMenu = () => {
    if (!menu) return;

    menu.classList.remove("hidden");
    requestAnimationFrame(() => {
      menu.classList.remove("opacity-0");
      menu.classList.add("opacity-100");
    });

    menu.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  };

  /** CLOSE MOBILE MENU */
  const closeMobileMenu = () => {
    if (!menu) return;

    menu.classList.remove("opacity-100");
    menu.classList.add("opacity-0");

    setTimeout(() => {
      menu.classList.add("hidden");
      menu.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }, OPEN_CLOSE_MS);
  };

  openBtn?.addEventListener("click", openMobileMenu);
  closeBtn?.addEventListener("click", closeMobileMenu);

  // Close on clicking menu links
  menu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", closeMobileMenu);
  });
</script>
