---
// COMPONENTS //
import { Icon } from "astro-icon/components";

// OTHERS //
import BrandLogo from "./BrandLogo.astro";
import RoundedButton from "./RoundedButton.astro";

// Define props
interface Props {
  menuItems: { name: string; url: string }[];
}

const { menuItems = [] } = Astro.props;
const currentPath = Astro.url.pathname;
---

<div
  id="mobile-menu"
  class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300 ease-in-out lg:hidden"
  aria-hidden="true"
>
  <div class="container mx-auto flex h-full flex-col justify-between px-6 py-6">
    <!-- Logo + Close Button -->
    <div class="flex items-center justify-between z-10">
      <BrandLogo width={140} />

      <button
        id="mobile-menu-close"
        class="bg-n-100 flex size-10 items-center justify-center rounded-full"
        aria-label="Close mobile menu"
        type="button"
      >
        <Icon name="close" />
      </button>
    </div>

    <!-- Menu Items -->
    <div class="flex flex-1 flex-col gap-6 pt-28 leading-tight z-10">
      {
        menuItems.map((item) => {
          const isActive = currentPath === item.url;
          return (
            <a
              href={item.url}
              class={`nav-link hidden-pos text-4xl leading-tight font-normal transition-colors ${
                isActive ? "text-n-950" : "text-n-500"
              }`}
            >
              {item.name}
            </a>
          );
        })
      }
    </div>

    <!-- Bottom Buttons -->
    <div class="flex flex-row justify-center gap-2.5">
      <RoundedButton buttonText="Call" />
      <RoundedButton buttonText="Whatsapp" />
    </div>
  </div>

  <!-- Floating Pixolo logo icon -->
  <div class="float-wrapper">
    <Icon
      name={"pixolo-icon"}
      class="pixolo-logo-anim right-20px absolute top-[20%] right-[40%] size-48 -rotate-30 transition-all"
    />
  </div>

  <!-- Circle at back of the links -->
  <div
    class="back-circle-anim absolute size-[500px] transition-all rounded-full bg-n-800 left-[-80%] opacity-5 top-[10%]"
  >
  </div>
</div>
<style>
  #mobile-menu {
    position: fixed;
    overflow: hidden; /* So before-circle does not overflow */
  }

  #mobile-menu::before {
    content: "";
    position: fixed;
    width: 80px;
    height: 80px;
    background: var(--color-n-50);
    border-radius: 50%;
    top: 12px;
    right: 12px;
    transition: all;
    transform: scale(0);
    transition: transform 0.7s ease-in-out;
    transform-origin: center;
    z-index: 0;
  }

  /* When menu becomes visible */
  #mobile-menu.menu-open::before {
    transform: scale(26);
  }
  .nav-link.hidden-pos {
    opacity: 0;
    transform: translateX(-20px);
  }

  /* Open animation */
  @keyframes nav-link-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .nav-link.start {
    animation: nav-link-in 0.3s ease forwards;
  }

  /* Close animation */
  @keyframes nav-link-out {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(-20px);
    }
  }

  .nav-link.reverse {
    animation: nav-link-out 0.3s ease forwards;
  }

  @keyframes float-circle {
    from {
      transform: translate3d(0, 0, 0);
    }
    to {
      transform: translate3d(120%, 20%, 0);
    }
  }
  .back-circle-anim {
    transition: all;
    animation: float-circle 5s ease-in-out infinite alternate;
  }

  /* Wrapper rotates in a circle */
  @keyframes circular-float {
    0% {
      transform: rotate(0deg) translateX(280px) rotate(0deg);
    }
    100% {
      transform: rotate(360deg) translateX(280px) rotate(360deg);
    }
  }

  .pixolo-logo-anim {
    animation: circular-float 50s linear infinite;
  }
</style>

<script>
  const openBtn = document.getElementById("open-mobile-menu-button");
  const closeBtn = document.getElementById("mobile-menu-close");
  const menu = document.getElementById("mobile-menu");

  /** OPEN MOBILE MENU */
  const openMobileMenu = () => {
    if (!menu) return;

    const links = menu.querySelectorAll("a.nav-link");
    menu.classList.remove("hidden");

    // Restart animation properly
    links.forEach((link, index) => {
      link.classList.add("opacity-0");
      link.classList.remove("reverse");
      link.classList.remove("hidden-pos");
      link.classList.add("start");
      link.style.animationDelay = `${index * 0.1}s`;
    });

    menu.classList.remove("hidden");
    requestAnimationFrame(() => {
      menu.classList.remove("opacity-0");
      menu.classList.add("opacity-100");
      menu.classList.add("menu-open");
    });

    menu.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  };

  /** CLOSE MOBILE MENU */
  const closeMobileMenu = () => {
    if (!menu) return;

    const links = menu.querySelectorAll("a.nav-link");

    links.forEach((link, index) => {
      link.classList.remove("opacity-0");
      link.classList.remove("start");
      link.classList.add("reverse");
      link.style.animationDelay = `${(links.length - 1 - index) * 0.1}s`;
    });

    // reverse circle
    menu.classList.remove("menu-open");

    // Time for for the animation to get over
    const lastDelay = (links.length - 1) * 100; // in ms
    const totalTime = lastDelay + 300;

    setTimeout(() => {
      menu.classList.add("hidden");
      menu.setAttribute("aria-hidden", "true");

      // Reset reverse class
      links.forEach((link) => link.classList.remove("reverse"));

      document.body.style.overflow = "";
    }, totalTime);
  };

  openBtn?.addEventListener("click", openMobileMenu);
  closeBtn?.addEventListener("click", closeMobileMenu);

  // Close on clicking menu links
  menu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", closeMobileMenu);
  });
</script>
<script>
  const logo = document.querySelector(".pixolo-logo-anim");

  function randomFloat() {
    if (!logo) return;

    // Get viewport dimensions
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    // Safe random positions so it doesnâ€™t jump fully off-screen
    const x = Math.random() * (vw * 0.6) - vw * 0.3; // range: -30% to +30%
    const y = Math.random() * (vh * 0.6) - vh * 0.3; // range: -30% to +30%

    logo.style.transform = `translate(${x}px, ${y}px)`;
  }

  // Move initially
  randomFloat();

  // Move every 4 seconds
  setInterval(randomFloat, 4000);
</script>
