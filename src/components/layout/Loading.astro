---
import { Icon } from "astro-icon/components";
---

<section
  id="loading-screen"
  class="fixed z-[999] flex h-screen w-screen flex-col items-center justify-center bg-n-50 overflow-hidden text-center transition-opacity duration-700"
>
  <div class="relative flex items-center justify-center w-full h-full">
    <svg
      class="ball"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="10" cy="10" r="8" fill="white"></circle>
    </svg>

    <!-- Step 1: Hello -->
    <p class="firstText text-n-950 text-5xl font-regular">Hello</p>

    <!-- Step 2: We are -->
    <p class="secondText text-n-950 text-5xl font-regular">We are</p>

    <!-- Step 3: Pixolo -->
    <div class="pixolo flex gap-1 items-center justify-center">
      <Icon name="pixolo-icon" class="w-[101px] h-[101px]" />
      <Icon name="pixolo" class="w-full h-[68px]" />
    </div>

    <!-- Loader Number -->
    <div class="absolute bottom-[4%] right-[12%]">
      <p id="progress-label" class="text-n-950 text-5xl text-right font-bold">
        0%
      </p>
    </div>
  </div>
</section>
<style>
  .ball {
    position: absolute;
    left: 14%;

    animation:
      bounce 8s ease-in-out 1 forwards,
      movement 12s ease-in-out 8s 1 forwards;
  }

  @keyframes bounce {
    0% {
      left: 0%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    8% {
      left: 8%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    16% {
      left: 17%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    24% {
      left: 27%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    32% {
      left: 35%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    40% {
      left: 45%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    48% {
      left: 50%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    56% {
      left: 50%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    62% {
      left: 50%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    70% {
      left: 50%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    78% {
      left: 50%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    84% {
      left: 50%;
      top: 21%;
      -webkit-animation-timing-function: ease-in;
    }
    90% {
      left: 50%;
      top: 50%;
      -webkit-animation-timing-function: ease-in;
    }
    100% {
      left: 47.2%;
      top: 45.5%;
      -webkit-animation-timing-function: ease-in;
    }
  }

  /* Common base */
  .firstText,
  .secondText,
  .pixolo {
    position: absolute;
    opacity: 0;
    transform-origin: center;
  }

  /* Hello: fade up and scale out */
  .firstText {
    animation: firstTextAnim 1s ease-in-out forwards;
    animation-delay: 5s;
  }

  /* We Are: scale in, scale out */
  .secondText {
    animation: secondTextAnim 1s ease-in-out forwards;
    animation-delay: 6s;
  }

  /* Pixolo: fade and stay visible */
  .pixolo {
    animation: pixoloAnim 2s ease-in-out forwards;
    animation-delay: 7s;
  }

  /* Keyframes */
  @keyframes firstTextAnim {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(1);
    }
    15%,
    85% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: scaleX(0);
    }
  }

  @keyframes secondTextAnim {
    0% {
      opacity: 0;
      transform: scaleX(0);
    }
    15%,
    85% {
      opacity: 1;
      transform: scaleX(1);
    }
    100% {
      opacity: 0;
      transform: scaleX(0);
    }
  }

  @keyframes pixoloAnim {
    0% {
      opacity: 0;
      transform: scaleX(0);
    }
    15%,
    100% {
      opacity: 1;
      transform: scaleX(1);
    }
  }
</style>

<script is:inline>
  const label = document.getElementById("progress-label");

  let progress = 0;
  let fakeInterval;

  function updateUI() {
    label.textContent = Math.floor(progress) + "%";
  }

  /** Start fake progress but stop before 100% */
  function startFakeProgress() {
    fakeInterval = setInterval(() => {
      if (progress < 90) {
        progress += Math.random() * 3;
        if (progress > 90) progress = 90;
        updateUI();
      }
    }, 120);
  }

  /** When animations complete, then finish to 100% */
  function finishProgress() {
    clearInterval(fakeInterval);

    const complete = setInterval(() => {
      if (progress < 100) {
        progress += 2;
        if (progress > 100) progress = 100;
        updateUI();
      } else {
        clearInterval(complete);
        loader.classList.add("fade-out");
        setTimeout(() => loader.remove(), 700);
      }
    }, 30);
  }

  // Start the Fake progress to < 100%
  startFakeProgress();

  // Total animation duration = 2s + 2s + 2s = 6s
  // Wait 6s, then finish progress
  setTimeout(() => {
    finishProgress();
  }, 6000);

  // Optional: if the window loads earlier, still ensure finish runs
  // window.addEventListener("load", () => {
  //   setTimeout(() => {
  //     finishProgress();
  //   }, 6000);
  // });
</script>
