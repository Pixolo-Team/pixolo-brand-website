---
import { Icon } from "astro-icon/components";
---

<section
  id="loading-screen"
  class="fixed z-[999] flex h-screen w-screen flex-col items-center justify-center bg-n-50 overflow-hidden text-center transition-opacity duration-700"
>
  <div class="relative flex items-center justify-center w-full h-full">
    <svg
      class="absolute z-[9999] ball -left-[14%] top-[18%]"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="10" cy="10" r="10" fill="white"></circle>
    </svg>
    <!-- Step 1: Hello -->
    <p class="firstText text-n-950 text-5xl font-regular">Hello</p>

    <!-- Step 2: We are -->
    <p class="secondText text-n-950 text-5xl font-regular">We are</p>

    <!-- Step 3: Pixolo -->
    <div class="pixolo h-[72px]">
      <Icon name="pixolo" class="w-full h-full" />
    </div>

    <div class="absolute bottom-[4%] right-[12%]">
      <p id="progress-label" class="text-n-950 text-5xl text-right font-bold">
        0%
      </p>
    </div>
  </div>
</section>
<style>
  .ball {
    offset-path: path(
      "M-149 0.5C-149 0.5 -136.866 349.5 -64.0604 349.5C8.74496 349.5 53.7427 0.5 119.975 0.5C186.208 0.5 231.711 349.5 296.427 349.5C361.143 349.5 427.376 0.5 495.631 0.5C563.886 0.5 579.559 349.5 645.286 349.5C711.013 349.5 773.707 0.5 833.367 0.5C893.027 0.5 960 300.5 960 300.5V0.5L969.371 300.5L981 0.5"
    );
    offset-rotate: auto;
    animation: moveBall 5s ease-in-out forwards;
  }

  @keyframes moveBall {
    0% {
      offset-distance: 0%;
    }
    100% {
      offset-distance: 100%;
    }
  }
  /* Common base */
  .firstText,
  .secondText,
  .pixolo {
    position: absolute;
    opacity: 0;
    transform-origin: center;
  }

  /* Hello: fade up and scale out */
  .firstText {
    animation: firstTextAnim 2s ease-in-out forwards;
    animation-delay: 0s;
  }

  /* We Are: scale in, scale out */
  .secondText {
    animation: secondTextAnim 2s ease-in-out forwards;
    animation-delay: 2s;
  }

  /* Pixolo: fade and stay visible */
  .pixolo {
    animation: pixoloAnim 2s ease-in-out forwards;
    animation-delay: 4s;
  }

  /* Keyframes */
  @keyframes firstTextAnim {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(1);
    }
    15%,
    85% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(0);
    }
  }

  @keyframes secondTextAnim {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    15%,
    85% {
      opacity: 1;
      transform: scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(0);
    }
  }

  @keyframes pixoloAnim {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    15%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>

<script is:inline>
  const label = document.getElementById("progress-label");

  let progress = 0;
  let fakeInterval;

  function updateUI() {
    label.textContent = Math.floor(progress) + "%";
  }

  // Start fake progress but stop before 100%
  function startFakeProgress() {
    fakeInterval = setInterval(() => {
      if (progress < 90) {
        progress += Math.random() * 3;
        if (progress > 90) progress = 90;
        updateUI();
      }
    }, 120);
  }

  // When animations complete, then finish to 100%
  function finishProgress() {
    clearInterval(fakeInterval);

    const complete = setInterval(() => {
      if (progress < 100) {
        progress += 2;
        if (progress > 100) progress = 100;
        updateUI();
      } else {
        clearInterval(complete);
        loader.classList.add("fade-out");
        setTimeout(() => loader.remove(), 700);
      }
    }, 30);
  }

  startFakeProgress();

  // Total animation duration = 2s + 2s + 2s = 6s
  // Wait 6s, then finish progress
  setTimeout(() => {
    finishProgress();
  }, 6000);

  // Optional: if the window loads earlier, still ensure finish runs
  window.addEventListener("load", () => {
    setTimeout(() => {
      finishProgress();
    }, 6000);
  });
</script>
