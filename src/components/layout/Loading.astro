---
import { Icon } from "astro-icon/components";
---

<section
  id="loading-screen"
  class="fixed z-[999] flex h-screen w-screen flex-col items-center justify-center bg-n-50 overflow-hidden text-center transition-opacity duration-700"
>
  <div class="relative flex items-center justify-center w-full h-full">
    <svg width="969" height="350" viewBox="0 0 969 350" fill="none" xmlns="http://www.w3.org/2000/svg"
    class="absolute z-[9999] -left-[14%] top-[18%] h-full w-full">
      <path id="anim-path" d="M968.5 300.5L957 0.5V300.5L961.5 0.5V300.5C961.5 300.5 881.5 0.5 822.5 0.5C763.5 0.5 701.5 349.5 636.5 349.5C571.5 349.5 556 0.5 488.5 0.5C421 0.5 355.5 349.5 291.5 349.5C227.5 349.5 182.5 0.5 117 0.5C51.5 0.5 7 349.5 -65 349.5C-137 349.5 -149 0.5 -149 0.5" stroke="white"/>
      <circle offsetPath="#anim-path" id="ball" cy="259.5" r="10" fill="white"/>
    </svg>


    <!-- Step 1: Hello -->
    <p class="firstText text-n-950 text-5xl font-regular">Hello</p>

    <!-- Step 2: We are -->
    <p class="secondText text-n-950 text-5xl font-regular">We are</p>

    <!-- Step 3: Pixolo -->
    <div class="pixolo h-[72px]">
      <Icon name="pixolo" class="w-full h-full" />
    </div>

    <!-- Loader Number -->
    <div class="absolute bottom-[4%] right-[12%]">
      <p id="progress-label" class="text-n-950 text-5xl text-right font-bold">
        0%
      </p>
    </div>
  </div>
</section>
<style>
  #ball {
    offset-path: path(#anim-path);
    offset-rotate: auto;
    animation: moveBall 5s ease-in-out forwards;
  }

  @keyframes moveBall {
    0% {
      offset-distance: 0%;
    }
    100% {
      offset-distance: 100%;
    }
  }
  /* Common base */
  .firstText,
  .secondText,
  .pixolo {
    position: absolute;
    opacity: 0;
    transform-origin: center;
  }

  /* Hello: fade up and scale out */
  .firstText {
    animation: firstTextAnim 2s ease-in-out forwards;
    animation-delay: 0s;
  }

  /* We Are: scale in, scale out */
  .secondText {
    animation: secondTextAnim 2s ease-in-out forwards;
    animation-delay: 2s;
  }

  /* Pixolo: fade and stay visible */
  .pixolo {
    animation: pixoloAnim 2s ease-in-out forwards;
    animation-delay: 4s;
  }

  /* Keyframes */
  @keyframes firstTextAnim {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(1);
    }
    15%,
    85% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: scaleX(0);
    }
  }

  @keyframes secondTextAnim {
    0% {
      opacity: 0;
      transform: scaleX(0);
    }
    15%,
    85% {
      opacity: 1;
      transform: scaleX(1);
    }
    100% {
      opacity: 0;
      transform: scaleX(0);
    }
  }

  @keyframes pixoloAnim {
    0% {
      opacity: 0;
      transform: scaleX(0);
    }
    15%,
    100% {
      opacity: 1;
      transform: scaleX(1);
    }
  }
</style>

<script is:inline>
  const label = document.getElementById("progress-label");

  let progress = 0;
  let fakeInterval;

  function updateUI() {
    label.textContent = Math.floor(progress) + "%";
  }

  /** Start fake progress but stop before 100% */
  function startFakeProgress() {
    fakeInterval = setInterval(() => {
      if (progress < 90) {
        progress += Math.random() * 3;
        if (progress > 90) progress = 90;
        updateUI();
      }
    }, 120);
  }

  /** When animations complete, then finish to 100% */
  function finishProgress() {
    clearInterval(fakeInterval);

    const complete = setInterval(() => {
      if (progress < 100) {
        progress += 2;
        if (progress > 100) progress = 100;
        updateUI();
      } else {
        clearInterval(complete);
        loader.classList.add("fade-out");
        setTimeout(() => loader.remove(), 700);
      }
    }, 30);
  }

  // Start the Fake progress to < 100%
  startFakeProgress();

  // Total animation duration = 2s + 2s + 2s = 6s
  // Wait 6s, then finish progress
  setTimeout(() => {
    finishProgress();
  }, 6000);

  // Optional: if the window loads earlier, still ensure finish runs
  // window.addEventListener("load", () => {
  //   setTimeout(() => {
  //     finishProgress();
  //   }, 6000);
  // });
</script>
